<!DOCTYPE html>
<html>

<head>
    <title>Recipe display page</title>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyB8_rgXNr8HKUS5EEj8orWw8CsfuH_abXA",
            authDomain: "quick-c73d3.firebaseapp.com",
            databaseURL: "https://quick-c73d3.firebaseio.com",
            projectId: "quick-c73d3",
            storageBucket: "quick-c73d3.appspot.com",
            messagingSenderId: "886931690680",
            appId: "1:886931690680:web:833bfd4b71e4bedf7c104d"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <style>
        .header {
            text-align: center;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .checked {
            color: orange;
        }
    </style>
    <style>
        #dec {
            color: white;
            background-color: #EF8872;
            text-align: center;
            width: 80%;
            margin-left: 10%;
        }

        .recipes {
            margin-left: 10%;
            width: 80%;
            background-color: white;
            border:solid;
        }
    </style>
</head>

<body style="background-color: #A4EBE9;">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
            aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="navbarTogglerDemo01" style="">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item active">
                    <a class="nav-link" href="#!">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#!">Disabled</a>
                </li>
            </ul>
        </div>
    </nav>

    <br /><br />

    <div id="dec">
        <br />Here are the recipes based on your ingredients selected:<br /><br />
    </div>
    <div id="recipe_container">
    </div>
    <div class="recipes">
        <div style="float: right;">Time</div>
        <br />Recipe #1 <br /><br />
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <br />
    </div>
    <br />
    <div class="recipes">
        <div style="float: right;">Time</div>
        <br />Recipe #2 <br /><br />
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star"></span>
        <br />
    </div>
    <br />

    <div class="recipes">
        <div style="float: right;">Time</div>
        <br />Recipe #3 <br /><br />
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <br />
    </div>
    <br />

    <div class="recipes">
        <div style="float: right;">Time</div>
        <br />Recipe #4 <br /><br />
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <br />
    </div>

    <script>
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            $('#loginIndicator').text("Sign Out");
            console.log(user);
          } else {
                $('#loginIndicator').text("Sign In");
          }
        });
        let checker = (arr, target) => target.every(v => arr.includes(v));
        //Choices that were passed on to us
        var choices = JSON.parse(localStorage.getItem("choices"));
        //function that should generate divs. 
        function parseChoices() {
            var counter = 0;
            db.collection('recipes').get().then(function (snapshot) {
                snapshot.forEach(function(doc) {
                    //Checks if document contains all elements of ingredients. Can't get .where() to work.
                    if (checker(doc.data().ingredients, choices)) {
                        var tempDiv = document.createElement("div");
                        tempDiv.innerHTML = doc.data().name;
                        tempDiv.className = "recipes";
                        console.log("Code goes heeeeeeeeeere");
                        document.getElementById("recipe_container").appendChild(tempDiv);
                    };
                })
            });
        }
        parseChoices();

    </script>
</body>

</html>
